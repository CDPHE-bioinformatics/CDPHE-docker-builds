# CDPHE Analysis Virtual Machine

The code here is from the Colorado Deparment of Public Health and Environment's
(CDPHE) bioinformatic genomic surveillance group. This directory contains the
Dockerfile that has an installation setup that matches the base Google Cloud
Platform (GCP) virtual machine that we use for analysis.

## Requirements

- Docker (local machine)
- Google Cloud Platform

## Software Installed

We use many software packages for analysis. The software listed here is what is
installed as a base image for our bioinformaticians to use. It is the common or
shared list that we all use and isn't therefore inclusive of what we install
individually. Note it also includes Google Cloud agents.

1. Chrome Remote Desktop
2. Google Config and Ops Agents
3. Google Cloud CLI
4. Visual Studio Code
5. Docker
6. Java
7. R

## Other Software (Not Installed)

A list of other software commonly used is incluced here, but they are not
in the CDPHE analysis Dockerfile. Some of this software is difficult to
translate from a Docker container to a production VM. For example, some packages
don't install to a central directory with multi-user support; this means
individual users should install that software in their home directory instead.

1. StaPH-B Toolkit
2. Nextflow

## Container Design

To ease testing and therefore deployment, each of the listed software have their
own Dockerfile in their respective folders. To reduce the size and improve
building a container from our prerequisites, we combine those dockerfiles and
remove duplicate software/packages from the primary analysis Dockerfile.

## Deploy on GCP

The containers generated by the Dockerfiles aren't used directly. Instead, to
add the software to our VMs, we log in as root with `sudo su` and then run
each command directly.

For example, to install install curl, instead of:

```dockerfile
RUN apt-get update && apt-get install --assume-yes curl
```

SSH into the VM via GCE console's SSH button and elevate your login permissions
to root with `sudo su` and run:

```bash
apt-get update && apt-get install --assume-yes curl
```

## Post Installation

Some packages require configuration based on which user is logged in or for
runtime related requirements. The following provides links for doing so.

### Docker Without Root Privileges

Instead of using `sudo` to run `docker`, users may follow post installation
[instructions](https://docs.docker.com/engine/install/linux-postinstall/).

### Anaconda Without Root Privileges

Instead of using `sudo` to run `conda`, users may follow post installation
[instructions](https://docs.anaconda.com/free/anaconda/install/multi-user/)
